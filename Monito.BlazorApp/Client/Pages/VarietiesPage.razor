@page "/varieties"

@inject IProductService ProductService
@inject IVarietyService VarietyService

<h3>Varieties</h3>

<div>
    <label for="selectedProduct">Select Product:</label>
    <select id="selectedProduct" @bind="selectedProductId">
        <option value="0">Select a product...</option>
        @foreach (var product in products)
        {
            <option value="@product.Id">@product.Name</option>
        }
    </select>
</div>

@if (selectedProductId != 0 && selectedProductVarieties != null && selectedProductVarieties.Any())
{
    <h4>Varieties for @selectedProductName:</h4>
    <ul>
        @foreach (var variety in selectedProductVarieties)
        {
            <li>@variety.Name</li>
        }
    </ul>
}
else
{
    <p>No varieties available.</p>
}

@code {
    private IEnumerable<Product> products;
    private int selectedProductId;
    private string selectedProductName;
    private IEnumerable<Variety> selectedProductVarieties;

    protected override async Task OnInitializedAsync()
    {
        products = await ProductService.GetAllAsync();
    }

    private async Task LoadSelectedProductVarieties()
    {
        if (selectedProductId != 0)
        {
            var product = await ProductService.GetByIdAsync(selectedProductId);
            if (product != null)
            {
                selectedProductName = product.Name;
                selectedProductVarieties = product.Varieties;
            }
            else
            {
                selectedProductName = null;
                selectedProductVarieties = null;
            }
        }
    }

    private async Task OnSelectedProductChanged()
    {
        await LoadSelectedProductVarieties();
        StateHasChanged();
    }
}